<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="icon" href="img/diode (1).png" type="image/x-icon"/>
    <link rel="shortcut icon" href="img/diode (1).png" type="image/x-icon"/>

    <title>Vitri</title>

    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="vendor/devicons/css/devicons.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

    <link href="css/resume.min.css" rel="stylesheet">

  </head>

  <body id="page-top">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">
        <span class="d-block d-lg-none"><img src="img/diode (2).png"></span>
        <img src="">
        <span class="d-none d-lg-block">
          <img src="img/diode (4).png">
        </span>
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#about">Summary</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#experience">Design</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#education">Hardware</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#skills">Software</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#results">Results</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#conclusions">Conclusions</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#references">References</a>
          </li> 
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#awards">Apendix</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid p-0">

      <section class="resume-section p-3 p-lg-5 d-flex d-column" id="about">
        <div class="my-auto">
          <h1 class="mb-0">Vitri
            <span class="text-primary">GPS SMS Security Tracking System</span>
          </h1>
          <div class="subheading mb-5">Interfaces de equipo de cómputo · January - May 2018
          </div>
          <p class="mb-5">           
          This project consists of a combination of the SIM900 3G modules, GPS and inertial motion sensor (IMU) together with the development card STM32F407 Discovery, in order to create a security system that will allow the user to receive alerts of possible anomalies in motorcycle (if it is down), as well as inform another user about the event of a crash or fall on the motorcycle in order to quickly locate the accident
          </p>
          <div class="subheading mb-5">
            Rafael López Peña · Rubén Barajas Curiel· Víctor Daniel Green Silva
          </div>

        </div>
      </section>

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="experience">
        <div class="my-auto">
          <h2 class="mb-5">Design</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
              <h3 class="mb-0">Idea</h3>
              <p>            
              The focus of the idea is to find a way to help motorcyclists when they suffer an accident, since they are the vulnerable when they are on the road. This idea comes after seeing the number of accidents in the metropolitan area of ​​Guadalajara.
              </p>
            </div>
            <div class="resume-date text-md-right">
            </div>
          </div>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
              <h3 class="mb-0">Data</h3>
              <p>
              A consolidated report of the National Observatory of Road Safety (ONSV) recorded that, of the 7,158 deaths occurred in 2016 due to traffic accidents, 3,759 (52 percent) were motorcyclists: it indicates that every day 10 died on average
            </p>
            </div>
            <div class="resume-date text-md-right">
            </div>
          </div>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
              <h3 class="mb-0">Objective</h3>
              <p>
             Create a product that can send SMS messages warning that a mishap occurred and the location of it to help the person who was on the motorcycle, to have a drastic change in G forces, calculated thanks to an IMU.
              </p>
            </div>
            <div class="resume-date text-md-right">
            </div>
          </div>

        </div>

      </section>

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="education">
        <div class="my-auto">
          <h2 class="mb-5">Hardware</h2>

          <div class="resume-item d-flex flex-column flex-md-row mb-5">
            <div class="resume-content mr-auto">
              <h3 class="mb-0">Schematic</h3>
              <p>           
              The following diagram shows all the modules connected to the development board.
              </p>

              <center><img src="img/esquematico.jpg" style="width: 80%;"></center>
                
              <h3 class="mb-0">GPS</h3>
              <p>
               
                The NEO-6 series of modules is a family of stand-alone GPS receivers with the high-performance u-blox 6 engine. These flexible and cost-effective receivers offer numerous connectivity options in a miniature package of 16 x 12.2 x 2.4 mm. Its compact architecture and power and memory options make the NEO-6 modules ideal for mobile devices that run on batteries with very strict cost and space constraints. The u-blox 6 50 channel positioning engine features Time-To-First-Fix0 (TTFF) of less than 1 second. The dedicated acquisition engine, with 2 million correlators, is capable of performing massive parallel time / frequency spatial searches, allowing you to find satellites instantly. Innovative design and technology suppress sources of jams and mitigate multipath effects, giving NEO-6 GPS receivers excellent navigation performance even in the most challenging environments. <br><br>
                Specs:<br> 
                1. Input Voltaje: 2.7 to 3.6V.<br>
                2. Current: 67 mA.<br>
                3. Antenna Gain: 50 dB.<br>
                4. Operating Temeparture: -40 to 85 ° C.<br>
                5. Comunication: UART, USB, SPI, DDC.<br>
                6. Sensibility.<br>
                  - Navigation: -160 dBm.<br>
                  - Cold Start (autónomo): - 146 dBm.<br>
              </p>
                <center><img src="img/GPS_01.png" style="width: 30%;"></center>
              <h3 class="mb-0">GSM</h3>
              <p>     
                The GPRS SIMCOM SIM900 GSM Quad Band GSM Shield is an ultra-compact wireless communication card. The GPRS is configured and controlled via UART using AT commands. Ideal for remote systems, recursive communication, control points, sending text messages to cell phones, etc.<br><br>
                  Specs:<br>
                  1. Conecction via Serial.<br>
                  2. Quad-Band 850/ 900/ 1800/ 1900 MHz.<br>
                  3. GPRS multi-slot class 10/8.<br>
                  4. GPRS mobile station class B.<br>
                  5. GSM phaase 2/2+ Compatible.<br>
                  6. Class 4 (2 W (AT) 850 / 900 MHz).<br>
                  7. Class 1 (1 W (AT) 1800 / 1900MHz).<br>
                  8. Embedded TCP/UP.<br>
                  9. RTC Support.<br>
              </p>
                <center><img src="img/GSM_01.png" style="width: 30%;"></center>
              <h3 class="mb-0">GSM</h3>
              <p>     
                  The MPU-6050 is an inertial measurement unit (IMU) of six degrees of freedom (6DOF) manufactured by Invensense, which combines a 3-axis accelerometer and a 3-axis gyroscope. <br>
                  The communication can be done both by SPI and I2C bus, so it is easy to obtain the measured data. The supply voltage is low voltage between 2.4 to 3.6V. In most modules, this includes a voltage regulator that allows direct powering to 5V. <br>
                  It has digital analog converters (ADC) of 16 bits. The range of the accelerometer can be adjusted to ± 2g, ± 4g, ± 8g, and ± 16g, the gyroscope range to ± 250, ± 500, ± 1000, and ± 2000 ° / sec. <br>
                  It is a sensor consumes 3.5mA, with all the sensors and the DMP activated. It has an embedded temperature sensor, a high precision clock and programmable interruptions. <br>
                  The MPU-6050 incorporates an internal processor (DMP Digital Motion Processor) that executes complex MotionFusion algorithms to combine the measurements of the internal sensors, avoiding having to perform the filters externally.
              </p>
                <center><img src="img/IMU_01.png" style="width: 15%;"></center>
              <h3 class="mb-0">STM32F4 Discovery</h3>
              <p>
                  
                  The STM32F4DISCOVERY kit takes advantage of the capabilities of STM32F407 high performance microcontrollers. Includes an integrated ST-LINK debugging tool, a ST-MEMS digital accelerometer, a digital microphone, an audio DAC with integrated class D loudspeaker driver, LED, buttons and a USB OTG micro-AB connector. <br> < br>
                  SPECIFICATIONS: <br>
                  1. STM32F407VGT6 microcontroller with ARM® Cortex® -M4 32 bits with FPU core, 1 Mbyte flash memory, 192 Kbytes RAM in a ST-LINK LQFP100 package. <br>
                  2. USB ST-LINK with counting capability and three different interfaces: <br>
                    - Debug port. <br>
                    - Power supply to the board: via the USB bus or an external power supply of 5 V. <br>
                    - External application power supply: 3 V and 5 V. <br>
                  3. 3-axis accelerometer LIS302DL or LIS3DSH ST MEMS. <br>
                  4. MP45DT02 ST-MEMS omnidirectional digital audio microphone sensor. <br>
                  5. Audio DAC CS43L22 with integrated Class D speaker driver. <br>
                  6. Eight LED: <br>
                    - LD1 (red / green) for USB communication. <br>
                    - LD2 (red) for a power of 3.3 V. <br>
                    - Four user LEDs, LD3 (orange), LD4 (green), LD5 (red) and LD6 (blue) 2 LED USB OTG LD7 (green) VBUS and LD8 (red) overcurrent. <br>
                  7. Two push buttons (user and restart). <br>
                  8. USB OTG FS with micro-AB connector. <br>
                  9. Extension header for all LQFP100 I / O for quick connection to the prototype board and easy probing. <br>
              </p>
                <center><img src="img/STM32F4_Discovery_01.png" style="width: 30%;"></center>
              <div class="subheading mb-3">I2C</div>
              <p>
                  I2C or Inter-Integrated Circuit is a serial bus of several masters and slaves. This protocol is commonly used with RTC modules, temperature sensors, EEPROM, IO expanders and more. <br>
                  The I2C protocol uses 2 cables: <br>
                  - SCL: serial clock, clock for serial synchronization. <br>
                  - SDA: serial data, bidirectional line to receive and transmit. <br>
                  Both cables need an external pull-up resistor, from approximately 4k7 to 47k, if you do not use pull-up resistors in the MCU. <br>
                  STM32F4 has up to 3 I2C, each of them has a pack of at least 2 pins for each I2C. The pins used for each I2C are described in the table below: <br>
              </p>
              <center><img src="img/Pin_I2C_01.png" style="width: 50%;"></center>
              <p>
                 A universal asynchronous receiver-transmitter is a hardware device for asynchronous serial communication in which the data format and transmission speeds are configurable. The levels and methods of electrical signaling are handled by a controller circuit external to the UART. One or more UART peripherals are commonly integrated into microcontroller chips. A related device, the universal synchronous and asynchronous receiver-transmitter (USART) also supports synchronous operation. The pins used for each USART are described in the table below: <br>
              </p>
              <center><img src="img/Pin_UART_01.png" style="width: 50%;"></center>
            </div>
            </div>
            <div class="resume-date text-md-right">
            </div>
          </div>
        </div>
      </section>

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="skills">
        <div class="my-auto">
          <h2 class="mb-5">Software</h2>
          <h3 class="mb-0"> System Flow</h3>
          <p>This is the way how our system acts depending on the different possible events.</p>
          <center><img src="img/system_flow.png"></center>
          <p>
            For the implementation of this system non-blocking code was used to avoid losing time during the execution, since in this case it is critical to have a quick response to the event.</p>

          <h3 class="mb-0"> I2C, IMU and Data Processing</h3>
          <p>
           The IMU can only communicate via I2C. so we developed a Header and Source that controlled this module and gave us the values ​​we need. For this we investigate in the data sheet the address of the module, since for I2C it is required to know the address of the slave.

            This module sends several data each time it is requested, as it is the values ​​of X, Y and Z in the acceleration and in the Gyroscope, as well as at temperature.
          </p>
          <center><img src="img/IMU.png"></center>
          <br>
          <p>
            For the flag associated with poor positioning, it is only managed with the angles of X and Y. It is expected to have enough data to be able to perform statistical operations such as the mean and the standard deviation. This is implemented the CMSIS libraries that ARM offers.
            Since on the way the bike vibrates, this puts a noise in the readings. To reduce this, a Pass-low filter weighted by an IIR structure was used, which significantly reduces this effect.
          </p>
          <center><img src="img/NoiseGate.PNG"></center>
          <center><strong> IIR structure to reduce noise. The parameter A goes from 0 to 1. The recmoendado is 0.96</strong></center>
          <br>
          <center><img src="img/Noise Gate 0.90.PNG" style="width: 80%;"></center>
          <center><strong> Input versus output of the IIR filter with A = 0.90.</strong></center>
          <br>
          <p>
            Para el cálculo de las Fuerzas G se calcula la magnitud del vector. Para activar la bandera de choque hay que superar la barrera. Según lo que investigamos un Choque a 50Km por hora es equivalente a un vector con magnitud de 3G. Por lo que decidimos que este fuese el factor con el cual se determinara el accidente.
          </p>
          <h3 class="mb-0">Serial communication and data collection.</h3>
          <p>      
            For GSM and GPS modules, communication through serial protocol is required. For the case of our card, there is no problem since it has 9 UART for Hardware.
            To be able to send SMS messages, we took care of detecting the GSM responses, so we created the Header and Source files that made this process.
            To manage the sending of messages in a non-blocking way, a state machine was implemented where through the OK_Flag and Promp_Flag flags we control the process.
          </p>
          <center><img src="img/SMS_State_Machine.png"></center>
          <br>
          <p>     
          Likewise, for the reception of the SMS we manage it by means of a state machine where from what is received active system flags.
          </p>

          <center><img src="img/Rx_SMS.png"></center>
          <p>
            In the case of the cost of the SMS, the messages that are sent are receivable, a pole that ensures that it will not be necessary to recharge the balance to the system.
          </p>
          <br>
          <p>        
          To obtain the coordinates using GPS, a Parser was implemented which analyzes the Frames sent by the module and waits until the one we are interested in arrives, which is $ GPRMC. This frame contains the location - both in latitude and longitude -, the time with respect to Greenwich and the date. 
          </p>
          <br>
          <p>     
            Through the use of all the flags that were mentioned, we coordinate the events in the main system.
            All the codes used are available in the following Git repository.
          </p>
          <center>
            <a target="_blank" href="https://github.com/Aribababa/Microcontrollers/tree/master/STM32F4/Vitri">
              <i class="fa fa-github" style="font-size:48px"></i>
            </a>
          </center>
        </div>
      </section>

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="results">
        <div class="my-auto">
          <h2 class="mb-5">Results</h2>
          <p>        
            In order to test the system, we assemble everything with the card and tie it together with the Power Bank and the other modules. The prototype of tests is the one presented in the following image.
          </p>

        <center><img src="img/vitri.jpg" style="width: 80%;"></center>
        <br>
        <p>    
          For debug issues, a Bluetooth module HC-06 was attached to it, which reported the cant, the magnitude of the G forces and the temperature of the system.
        </p>
        <p>
          The way to do tests was to wrap the system with alveolar Film and throw it from the top floor and see how it reacted. After several tests done we concluded that to rise to a force G greater than one is complicated without an appropriate laboratory, nevertheless, we could approach 0.8G and our device continued working correctly.
        </p>
        </div>  
      </section>

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="conclusions">
        <div class="my-auto">
          <h2 class="mb-5">Conclusions</h2>
          <p>          
          The system we developed exceeded some of our expectations. Since the prototype that we developed did not look robust enough for the tests, even so, we were able to demonstrate a lot of things. The biggest problem during the project was the programming of the card, since, for reasons of Firmware, the program started only when it was connected to a PC. This was solved by a more recent version. Another of the barriers that we had was the use of SMS, since these required to have a balance in the SIM, so we opted for it to send messages to collect and thus avoid this problem. In general, this project took more time in the testing part than in its development, since when doing the validation we must be sure that everything works in the correct way, since the most important thing when validating is the user's security
          </p>
        </div>
      </section>
      
        <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="references">
        <div class="my-auto">
          <h2 class="mb-5">Referencias</h2>
          <p>
              GPS               --> https://wiki.eprolabs.com/index.php?title=GPS_Module_NEO6MV2<br>
              GSM               --> https://hetpro-store.com/TUTORIALES/sim900-gsm-shieldarduino/<br>
              IMU               --> https://www.luisllamas.es/arduino-orientacion-imu-mpu-6050/<br>
              STM32F4 Discovery --> http://www.st.com/en/evaluation-tools/stm32f4discovery.html<br>
              UART              --> https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter<br>
                                --> https://stm32f4-discovery.net/2014/04/library-04-connect-stm32f429-discovery-to-computer-with-usart/<br>
              I2C               --> https://stm32f4-discovery.net/2014/05/library-09-i2c-for-stm32f4xx/<br>

          </p>
        </div>  
      </section>

      <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="awards">
        <div class="my-auto">
          <h2 class="mb-5">Apéndice</h2>
          <h3> A. Costo de los materiales</h3>
          <table style="width:100%">
            <tr>
              <th>Material</th>
              <th>Price</th> 
              <th>Distributor</th>
            </tr>
            <tr>
              <td>STM32F4 Discovery</td>
              <td>$30.00 USD</td> 
              <td>Newark Element 14</td>
            </tr>
            <tr>
              <td>MPU 6050</td>
              <td>$6.00 USD</td> 
              <td>HetPro Guadalajara</td>
            </tr>
            <tr>
              <td>SIM900 3G</td>
              <td>$36.00 USD</td> 
              <td>Mercado Libre México</td>
            </tr>
            <tr>
              <td>GPS GY-NEO6M</td>
              <td>$12.00 USD</td> 
              <td>Mercado Libre México</td>
            </tr>

            <tr>
              <td>Power Bank</td>
              <td>$28.00 USD</td> 
              <td>Mercado Libre México</td>
            </tr>
          </table>
          <br>
        </div>
      </section>

    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/resume.min.js"></script>

  </body>

</html>
